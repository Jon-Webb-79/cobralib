<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>cobralib.db &mdash; cobralib 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->

        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



          <a href="../../index.html" class="icon icon-home">
            cobralib
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../io.html">io</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../db.html">db</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">cobralib</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">cobralib.db</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <h1>Source code for cobralib.db</h1><div class="highlight"><pre>
<span></span><span class="c1"># Import necessary packages here</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Protocol</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mysql.connector</span> <span class="kn">import</span> <span class="p">(</span>
        <span class="n">DatabaseError</span><span class="p">,</span>
        <span class="n">Error</span><span class="p">,</span>
        <span class="n">InterfaceError</span><span class="p">,</span>
        <span class="n">ProgrammingError</span><span class="p">,</span>
        <span class="n">connect</span><span class="p">,</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Warning: mysql-connector-python package is not installed. &quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Some features may not work.&quot;</span>
    <span class="c1"># Handle the case when mysql-connector is not available</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pgdb</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Warning: postgresql package is not installed. &quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Some features may not work.&quot;</span>
    <span class="c1"># Handle the case when mysql-connector is not available</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">cobralib.io</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">read_excel_columns_by_headers</span><span class="p">,</span>
    <span class="n">read_pdf_columns_by_headers</span><span class="p">,</span>
    <span class="n">read_text_columns_by_headers</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>

<span class="c1"># File:    db.py</span>
<span class="c1"># Date:    July 17, 2023</span>
<span class="c1"># Author:  Jonathan A. Webb</span>
<span class="c1"># Purpose: This file contains functions and classes that are used to connect to and</span>
<span class="c1">#          manipulate databases</span>
<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>
<span class="c1"># Insert Code here</span>


<div class="viewcode-block" id="RelationalDB"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB">[docs]</a><span class="k">class</span> <span class="nc">RelationalDB</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A protocol class to handle structural sub-typing of classes used to read and</span>
<span class="sd">    interact with relational databases</span>

<span class="sd">    :ivar database: The name of the database currently being used</span>
<span class="sd">    :ivar conn: The connection attribute of the database management system</span>
<span class="sd">    :ivar cur: The cursor attribute of the database management system.</span>
<span class="sd">    :raises ConnectionError: If a connection can not be established</span>

<span class="sd">    More to be added later</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">database</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">conn</span><span class="p">:</span> <span class="n">Any</span>
    <span class="n">cur</span><span class="p">:</span> <span class="n">Any</span>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.close_connection"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.close_connection">[docs]</a>    <span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the connection to the database managment system</span>

<span class="sd">        :raises ConnectionError: If the connection does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.change_database"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.change_database">[docs]</a>    <span class="k">def</span> <span class="nf">change_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to change the connection from one database to another.</span>

<span class="sd">        :param database: The new database or database file to be used.  If a database</span>
<span class="sd">                        file, this must include the path length.</span>
<span class="sd">        :raises ConnectionError: if query fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.get_databases"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.get_databases">[docs]</a>    <span class="k">def</span> <span class="nf">get_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the names of all databases available to the user.</span>

<span class="sd">        :return: A pandas dataframe of database names with a header of Databases</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.get_database_tables"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.get_database_tables">[docs]</a>    <span class="k">def</span> <span class="nf">get_database_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to retrieve a dataframe containing a list of all tables wtihin</span>
<span class="sd">        the SQL database or database file.</span>

<span class="sd">        :param database: The name of the database or database file that the tables</span>
<span class="sd">                         will be retrieved from.</span>
<span class="sd">        :return df: A dataframe containing all information relating to the tables</span>
<span class="sd">                    within the database or database file.</span>
<span class="sd">        :raises ConnectionError: If program is not able to get tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.get_table_columns"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.get_table_columns">[docs]</a>    <span class="k">def</span> <span class="nf">get_table_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the names and data types of the columns within the specified table.</span>

<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param database: The database name, defaulted to currently selected database</span>
<span class="sd">                         or None</span>
<span class="sd">        :return: A Pandas Dataframe with the table information</span>
<span class="sd">        :raises ValueError: If the database is not selected at the class level</span>
<span class="sd">         :raises ConnectionError: If the columns cannot be retrieved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.execute_query"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.execute_query">[docs]</a>    <span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a query with placeholders and return the result as a Pandas DataFrame.</span>
<span class="sd">        The user of this class should ensure that when applicable they parameteratize</span>
<span class="sd">        the inputs to this method to minimize the potential for an injection</span>
<span class="sd">        attack</span>

<span class="sd">        :param query: The query with placeholders.</span>
<span class="sd">        :param params: The values to be substituted into the placeholders</span>
<span class="sd">                       (default is an empty tuple).</span>
<span class="sd">        :return: A Pandas DataFrame with the query result.</span>
<span class="sd">        :raises ValueError: If the database name is not provided.</span>
<span class="sd">        :raises ConnectionError: If the query execution fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.csv_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.csv_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">csv_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">csv_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">csv_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_headers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from a CSV or TXT file and insert it into the specified table.</span>

<span class="sd">        :param csv_file: The path to the CSV file or TXT file.</span>
<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param csv_headers: The names of the columns in the TXT file and datatypes</span>
<span class="sd">                            as a dictionary.</span>
<span class="sd">        :param table_headers: The names of the columns in the table (default is None,</span>
<span class="sd">                              assumes CSV column names and table column names</span>
<span class="sd">                              are the same).</span>
<span class="sd">        :param delimiter: The seperating delimeter in the text file.  Defaulted to</span>
<span class="sd">                          &#39;,&#39; for a CSV file, but can work with other delimeters</span>
<span class="sd">        :param skip: The number of rows to be skipped if metadata exists before</span>
<span class="sd">                     the header definition.  Defaulted to 0</span>
<span class="sd">        :raises ValueError: If the CSV file or table name is not provided, or if</span>
<span class="sd">                            the number of CSV columns and table columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.excel_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.excel_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">excel_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">excel_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">excel_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_headers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Sheet1&quot;</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from an Excel file and insert it into the specified table.</span>

<span class="sd">        :param excel_file: The path to the Excel file.</span>
<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param excel_headers: The names of the columns in the Excel file and their</span>
<span class="sd">                              data types as a dictionary.</span>
<span class="sd">        :param table_headers: The names of the columns in the table (default is None,</span>
<span class="sd">                              assumes Excel column names and table column names are</span>
<span class="sd">                              the same).</span>
<span class="sd">        :param sheet_name: The name of the sheet in the Excel file (default is &#39;Sheet1&#39;).</span>
<span class="sd">        :param skip: The number of rows to be skipped if metadata exists before</span>
<span class="sd">                     the header definition. Defaulted to 0.</span>
<span class="sd">        :raises ValueError: If the Excel file, table name, or sheet name is not</span>
<span class="sd">                            provided, or if the number of Excel columns and table</span>
<span class="sd">                            columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="RelationalDB.pdf_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.RelationalDB.pdf_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">pdf_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pdf_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pdf_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">page_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a table from a PDF file and insert it into the specified SQLite table.</span>

<span class="sd">        :param pdf_file: The path to the PDF file.</span>
<span class="sd">        :param table_name: The name of the SQLite table.</span>
<span class="sd">        :param pdf_headers: A dictionary of column names in the PDF and their data</span>
<span class="sd">                            types.</span>
<span class="sd">        :param table_columns: The names of the columns in the SQLite table</span>
<span class="sd">                              (default is None, assumes PDF column names and SQLite</span>
<span class="sd">                              column names are the same).</span>
<span class="sd">        :param table_idx: Index of the table in the PDF (default: 0).</span>
<span class="sd">        :param page_num: Page number from which to extract the table (default: 0).</span>
<span class="sd">        :param skip: The number of rows to skip in the PDF table.</span>
<span class="sd">        :raises ValueError: If the PDF file, table name, or sheet name is not</span>
<span class="sd">                            provided, or if the number of PDF headers and table</span>
<span class="sd">                            columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span></div></div>


<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>


<div class="viewcode-block" id="MySQLDB"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB">[docs]</a><span class="k">class</span> <span class="nc">MySQLDB</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for connecting to MySQL databases using mysql-connector-python.</span>
<span class="sd">    The user can access the conn and cur variables, where conn is the</span>
<span class="sd">    connection variable and cur is the connection.cursor() method to</span>
<span class="sd">    expand the capability of this class beyond its methods.</span>

<span class="sd">    :param username: The username for the database connection.</span>
<span class="sd">    :param password: The password for the database connection.</span>
<span class="sd">    :param port: The port number for the database connection. Defaulted to 3306</span>
<span class="sd">    :param hostname: The hostname for the database connection</span>
<span class="sd">                     (default is &#39;localhost&#39;).</span>
<span class="sd">    :param database: The database you wish to connect to, defaulted to None</span>
<span class="sd">    :raises ConnectionError: If a connection can not be established</span>
<span class="sd">    :ivar conn: The connection attribute of the mysql-connector-python module.</span>
<span class="sd">    :ivar cur: The cursor method for the mysql-connector-python module.</span>
<span class="sd">    :ivar database: The name of the database currently being used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3306</span><span class="p">,</span>
        <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">hostname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="c1"># self.conn = None.. code-block:: bash</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.change_database"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.change_database">[docs]</a>    <span class="k">def</span> <span class="nf">change_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change to the specified database within the server.</span>

<span class="sd">        :param database: The name of the database to change to.</span>
<span class="sd">        :raises ConnectionError: if query fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;USE </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to non-existing databases or insufficient permissions.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to change database due to ProgrammingError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to change database due to InterfaceError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to change database: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.close_connection"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.close_connection">[docs]</a>    <span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the connection to the server.</span>

<span class="sd">        :raises ConnectionError: If the connection does not exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to close the connection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.get_databases"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.get_databases">[docs]</a>    <span class="k">def</span> <span class="nf">get_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the names of all databases available to the user.</span>

<span class="sd">        :return: A pandas dataframe of database names with a header of Databases</span>
<span class="sd">        :raises ConnectionError: If program fails to retrive database</span>

<span class="sd">        If you assume the server has three databases available to the username, and</span>
<span class="sd">        those databases were ``Inventory``, ``Address``, ``project_data``, you</span>
<span class="sd">        could use this class with the following commands.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import MySQLDB</span>

<span class="sd">           db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           dbs = db.get_databases()</span>
<span class="sd">           db.close_conn()</span>
<span class="sd">           print(dbs)</span>
<span class="sd">           &gt;&gt; index  Databases</span>
<span class="sd">              0      Address</span>
<span class="sd">              1      Inventory</span>
<span class="sd">              2      project_data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SHOW DATABASES;&quot;</span><span class="p">)</span>
            <span class="n">databases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">databases</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Databases&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch databases due to InterfaceError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch databases: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.get_database_tables"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.get_database_tables">[docs]</a>    <span class="k">def</span> <span class="nf">get_database_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the names of all tables within the current database.</span>

<span class="sd">        :param database: Database name, defaulted to currently selected database or None</span>
<span class="sd">        :return: A pandas dataframe of table names with a header of Tables</span>
<span class="sd">        :raises ValueError: If no database is currently selected.</span>
<span class="sd">        :raises ConnectionError: If program is not able to get tables</span>

<span class="sd">        Assuming the user has a database titled ``Inventory`` which had the</span>
<span class="sd">        tables ``Names``, ``Product``, ``Sales``.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import MySQLDB</span>

<span class="sd">           db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           dbs = db.get_database_tables(&quot;Inventory&quot;)</span>
<span class="sd">           db.close_conn()</span>
<span class="sd">           print(dbs)</span>
<span class="sd">           &gt;&gt; index  Tables</span>
<span class="sd">              0      Names</span>
<span class="sd">              1      Product</span>
<span class="sd">              2      Sales</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No database is currently selected.&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to fetch tables from </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SHOW TABLES FROM </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tables</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tables&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; due to InterfaceError </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch tables from </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.get_table_columns"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.get_table_columns">[docs]</a>    <span class="k">def</span> <span class="nf">get_table_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Retrieve the names and data types of the columns within the specified table.</span>

<span class="sd">         :param table_name: The name of the table.</span>
<span class="sd">         :param database: The database name, defaulted to currently selected database</span>
<span class="sd">                          or None</span>
<span class="sd">         :return: A pandas dataframe with headers ot Field, Type, Null, Key, Default,</span>
<span class="sd">                  and Extra</span>
<span class="sd">         :raises ValueError: If the database is not selected at the class level</span>
<span class="sd">         :raises ConnectionError: If the columns cannot be retrieved.</span>

<span class="sd">         This example shows a scenario where the database analyst has navigated</span>
<span class="sd">         into a database</span>

<span class="sd">         .. highlight:: python</span>
<span class="sd">         .. code-block:: python</span>

<span class="sd">            from cobralib.io import MySQLDB</span>

<span class="sd">            db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">            db.change_database(&#39;Address&#39;)</span>
<span class="sd">            query = &#39;&#39;&#39;CREATE TABLE IF NOT EXIST Names (</span>
<span class="sd">                name_id INTEGER AUTO_INCREMENT,</span>
<span class="sd">                FirstName VARCHAR(20) NOT NULL,</span>
<span class="sd">                MiddleName VARCHAR(20),</span>
<span class="sd">                LastName VARCHAR(20) NOT NULL,</span>
<span class="sd">                PRIMARY KEY (name_id)</span>
<span class="sd">            );</span>
<span class="sd">            &#39;&#39;&#39;</span>
<span class="sd">            db.execute_query(query)</span>
<span class="sd">            cols = db.get_table_columns(&#39;Names&#39;)</span>
<span class="sd">            db.close_conn()</span>
<span class="sd">            print(cols)</span>
<span class="sd">            &gt;&gt; index Field      Type        Null   Key     Default  Extra</span>
<span class="sd">               0     name_id    Integer     True   Primary  False   auto_increment</span>
<span class="sd">               1     FirstName  Varchar(20) False  NA       False   None</span>
<span class="sd">               2     MiddleName Varchar(20) True   NA       False   None</span>
<span class="sd">               3     LastName   Varchar(20) False  NA       False   None</span>

<span class="sd">        However, this code can also be executed when not in the database</span>

<span class="sd">         .. code-block:: python</span>

<span class="sd">            from cobralib.io import MySQLDB</span>

<span class="sd">            db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">            cols = db.get_table_columns(&#39;Names&#39;, &#39;Address&#39;)</span>
<span class="sd">            db.close_conn()</span>
<span class="sd">            print(cols)</span>
<span class="sd">            &gt;&gt; index Field      Type        Null   Key     Default  Extra</span>
<span class="sd">               0     name_id    Integer     True   Primary  False   auto_increment</span>
<span class="sd">               1     FirstName  Varchar(20) False  NA       False   None</span>
<span class="sd">               2     MiddleName Varchar(20) True   NA       False   None</span>
<span class="sd">               3     LastName   Varchar(20) False  NA       False   None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to fetch columns from </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">database</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No database is currently selected.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SHOW COLUMNS FROM </span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">columns_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">columns_info</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Null&quot;</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="s2">&quot;Extra&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; fue to InterfaceError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch columns from </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.execute_query"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.execute_query">[docs]</a>    <span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a query with placeholders and return the result as a Pandas DataFrame.</span>
<span class="sd">        The user of this class should ensure that when applicable they parameteratize</span>
<span class="sd">        the inputs to this method to minimize the potential for an injection</span>
<span class="sd">        attack</span>

<span class="sd">        :param query: The query with placeholders.</span>
<span class="sd">        :param params: The values to be substituted into the placeholders</span>
<span class="sd">                       (default is an empty tuple).</span>
<span class="sd">        :return: A Pandas DataFrame with the query result.</span>
<span class="sd">        :raises ValueError: If the database name is not provided.</span>
<span class="sd">        :raises ConnectionError: If the query execution fails.</span>

<span class="sd">        Example usage when parameters are provided:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import MySQLDB</span>

<span class="sd">           db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           query = &quot;SELECT * FROM names WHERE name_id = %s&quot;</span>
<span class="sd">           params = (2,)</span>
<span class="sd">           result = db.execute_query(query, params)</span>
<span class="sd">           print(result)</span>
<span class="sd">           &gt;&gt; index  name_id  FirstName  LastName</span>
<span class="sd">              0      2        Fred       Smith</span>

<span class="sd">        Example usage when no parameters are provided:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import MySQLDB</span>

<span class="sd">           db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           query = &quot;SELECT * FROM names&quot;</span>
<span class="sd">           result = db.execute_query(query)</span>
<span class="sd">           print(result)</span>
<span class="sd">           &gt;&gt; index  name_id  FirstName  LastName</span>
<span class="sd">            0        1        Jon        Webb</span>
<span class="sd">            1        2        Fred       Smith</span>
<span class="sd">            2        3        Jillian    Webb</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The number of placeholders in the query does not match &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;the number of parameters.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No database is currently selected.&quot;</span><span class="p">)</span>

        <span class="n">num_placeholders</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_placeholders</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

            <span class="c1"># Check if there&#39;s a result set available</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
                <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">df</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>  <span class="c1"># No rows to return</span>

        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to execute query: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to execute query: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.csv_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.csv_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">csv_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">csv_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">csv_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_headers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from a CSV or TXT file and insert it into the specified table.</span>

<span class="sd">        :param csv_file: The path to the CSV file or TXT file.</span>
<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param csv_headers: The names of the columns in the TXT file and datatypes</span>
<span class="sd">                            as a dictionary.</span>
<span class="sd">        :param table_headers: The names of the columns in the table (default is None,</span>
<span class="sd">                              assumes CSV column names and table column names</span>
<span class="sd">                              are the same).</span>
<span class="sd">        :param delimiter: The seperating delimeter in the text file.  Defaulted to</span>
<span class="sd">                          &#39;,&#39; for a CSV file, but can work with other delimeters</span>
<span class="sd">        :param skip: The number of rows to be skipped if metadata exists before</span>
<span class="sd">                     the header definition.  Defaulted to 0</span>
<span class="sd">        :raises ValueError: If the CSV file or table name is not provided, or if</span>
<span class="sd">                            the number of CSV columns and table columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>

<span class="sd">        Assune we have a csv table with the following Columns, ``FirstName``,</span>
<span class="sd">        ``MiddleName``, ``LastName``.  Within the ``Names`` database we have</span>
<span class="sd">        a table with no entries that has columns for ``First`` and ``Last``.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import MySQLDB</span>

<span class="sd">           db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           db.change_db(&#39;Names&#39;)</span>
<span class="sd">           db.csv_to_table(&#39;csv_file.csv&#39;, &#39;FirstLastName&#39;,</span>
<span class="sd">                           [&#39;FirstName&#39;: str, &#39;LastName&#39;: str],</span>
<span class="sd">                           [&#39;First&#39;, &#39;Last&#39;])</span>
<span class="sd">           query = &quot;SELDCT * FROM Names;&quot;</span>
<span class="sd">           result = db.query_db(query)</span>
<span class="sd">           print(result)</span>
<span class="sd">           &gt;&gt; index  name_id First   Last</span>
<span class="sd">              0      1       Jon     Webb</span>
<span class="sd">              1      2       Fred    Smith</span>
<span class="sd">              2      3       Jillian Webb</span>

<span class="sd">        If instead of a csv file, you have a text file that uses spaces as</span>
<span class="sd">        a delimeter, and the first two rows are consumed by file metadata</span>
<span class="sd">        before reaching the header, the following code will work</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import MySQLDB</span>

<span class="sd">           db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           db.change_db(&#39;Names&#39;)</span>
<span class="sd">           db.csv_to_table(&#39;txt_file.txt&#39;, &#39;FirstLastName&#39;,</span>
<span class="sd">                           [&#39;FirstName&#39;: str, &#39;LastName&#39;: str],</span>
<span class="sd">                           [&#39;First&#39;, &#39;Last&#39;], delemeter=r&quot;\\s+&quot;, skip=2)</span>
<span class="sd">           query = &quot;SELDCT * FROM Names;&quot;</span>
<span class="sd">           result = db.query_db(query)</span>
<span class="sd">           print(result)</span>
<span class="sd">           &gt;&gt; index  name_id First   Last</span>
<span class="sd">              0      1       Jon     Webb</span>
<span class="sd">              1      2       Fred    Smith</span>
<span class="sd">              2      3       Jillian Webb</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CSV column names are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">csv_data</span> <span class="o">=</span> <span class="n">read_text_columns_by_headers</span><span class="p">(</span>
                <span class="n">csv_file</span><span class="p">,</span> <span class="n">csv_headers</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_headers</span>
            <span class="p">]</span>

            <span class="n">csv_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table_headers</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">csv_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">insert_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># Commit changes</span>
        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.excel_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.excel_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">excel_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">excel_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">excel_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_headers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Sheet1&quot;</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from an Excel file and insert it into the specified table.</span>

<span class="sd">        :param excel_file: The path to the Excel file.</span>
<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param excel_headers: The names of the columns in the Excel file and their</span>
<span class="sd">                              data types as a dictionary</span>
<span class="sd">        :param table_headers: The names of the columns in the table (default is None,</span>
<span class="sd">                              assumes Excel column names and table column names are</span>
<span class="sd">                              the same).</span>
<span class="sd">        :param sheet_name: The name of the sheet in the Excel file</span>
<span class="sd">                           (default is &#39;Sheet1&#39;).</span>
<span class="sd">        :param skip: The number of rows to be skipped if metadata exists before</span>
<span class="sd">                     the header definition.  Defaulted to 0</span>
<span class="sd">        :raises ValueError: If the Excel file, table name, or sheet name is not</span>
<span class="sd">                            provided, or if the number of Excel columns and table</span>
<span class="sd">                            columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>

<span class="sd">        Assune we have an excel table with the following Columns, ``FirstName``,</span>
<span class="sd">        ``MiddleName``, ``LastName``.  Within the ``Names`` database we have</span>
<span class="sd">        a table with no entries that has columns for ``First`` and ``Last``.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import MySQLDB</span>

<span class="sd">           db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           db.change_db(&#39;Names&#39;)</span>
<span class="sd">           db.csv_to_table(&#39;excel_file.xlsx&#39;, &#39;FirstLastName&#39;,</span>
<span class="sd">                           {&#39;FirstName&#39;: str, &#39;LastName&#39;: str},</span>
<span class="sd">                           [&#39;First&#39;, &#39;Last&#39;])</span>
<span class="sd">           query = &quot;SELDCT * FROM Names;&quot;</span>
<span class="sd">           result = db.query_db(query)</span>
<span class="sd">           print(result)</span>
<span class="sd">           &gt;&gt; index  name_id First   Last</span>
<span class="sd">              0      1       Jon     Webb</span>
<span class="sd">              1      2       Fred    Smith</span>
<span class="sd">              2      3       Jillian Webb</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excel_headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Excel column names are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">excel_data</span> <span class="o">=</span> <span class="n">read_excel_columns_by_headers</span><span class="p">(</span>
                <span class="n">excel_file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">excel_headers</span><span class="p">,</span> <span class="n">skip</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">excel_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_headers</span>
            <span class="p">]</span>

            <span class="n">excel_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">excel_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">excel_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table_headers</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">excel_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">insert_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="MySQLDB.pdf_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.MySQLDB.pdf_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">pdf_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pdf_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pdf_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">page_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a table from a PDF file and insert it into the specified MySQL table.</span>

<span class="sd">        :param pdf_file: The path to the PDF file.</span>
<span class="sd">        :param table_name: The name of the MySQL table.</span>
<span class="sd">        :param pdf_headers: A dictionary of column names in the PDF and their data</span>
<span class="sd">                            types.</span>
<span class="sd">        :param table_columns: The names of the columns in the MySQL table</span>
<span class="sd">                              (default is None, assumes PDF column names and MySQL</span>
<span class="sd">                              column names are the same).</span>
<span class="sd">        :param table_idx: Index of the table in the PDF (default: 0).</span>
<span class="sd">        :param page_num: Page number from which to extract the table (default: 0).</span>
<span class="sd">        :param skip: The number of rows to skip in the PDF table.</span>
<span class="sd">        :raises ValueError: If the PDF file, table name, or sheet name is not</span>
<span class="sd">                            provided, or if the number of PDF headers and table</span>
<span class="sd">                            columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pdf_headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PDF headers are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Read the table from the PDF file</span>
            <span class="n">pdf_data</span> <span class="o">=</span> <span class="n">read_pdf_columns_by_headers</span><span class="p">(</span>
                <span class="n">pdf_file</span><span class="p">,</span> <span class="n">pdf_headers</span><span class="p">,</span> <span class="n">table_idx</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">skip</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">table_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pdf_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_columns</span>
            <span class="p">]</span>
            <span class="n">pdf_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pdf_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">pdf_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table_columns</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">pdf_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">insert_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ==========================================================================================</span>
    <span class="c1"># PRIVATE-LIKE METHOD</span>

    <span class="k">def</span> <span class="nf">_create_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">passwd</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a connection to the MySQL database.</span>

<span class="sd">        :return: The MySQL connection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span>
                <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">passwd</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create a connection due to InterfaceError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle programming errors.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create a connection due to ProgrammingError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle other database-related errors.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create a connection due to DatabaseError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create a connection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_sanitize_column_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sanitize column names to include only alphanumeric characters and underscores.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\W|^(?=\d)&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>


<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>


<div class="viewcode-block" id="SQLiteDB"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB">[docs]</a><span class="k">class</span> <span class="nc">SQLiteDB</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for connection to a SQLite database file using the sqlite3 python package.</span>
<span class="sd">    The usser can access the conn and cur variables, where conn is the connection</span>
<span class="sd">    variable and cur is the connection.cursor() method to expand the capability</span>
<span class="sd">    of this class beyond its methods.  **NOTE:** If the user passes an incorrect</span>
<span class="sd">    database name to the constructor, the class will assume that the user wants</span>
<span class="sd">    to create a database of that name, and will create a new database file.</span>

<span class="sd">    :param database: The name of the database file to include its path length.</span>
<span class="sd">    :raises ConnectionError: If a connection can not be established.</span>
<span class="sd">    :ivar conn: The connection attribute of the sqlite3 module.</span>
<span class="sd">    :ivar cur: The cursor method for the sqlite3 module.</span>
<span class="sd">    :ivar database: The name of the database currently being used.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SQLiteDB.close_connection"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.close_connection">[docs]</a>    <span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the connection to tjhe SQLite database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SQLiteDB.change_database"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.change_database">[docs]</a>    <span class="k">def</span> <span class="nf">change_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to change the connection from one database file to another</span>

<span class="sd">        :paramn database: The new database file to be used to include the path length</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>
<div class="viewcode-block" id="SQLiteDB.get_databases"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.get_databases">[docs]</a>    <span class="k">def</span> <span class="nf">get_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method included for compatibility with RelationalDB Protocol class. This method</span>
<span class="sd">        returns an empty dataframe since SQLite does not support true databases.</span>

<span class="sd">        :return : An empty pandas dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SQLite does not support databases, returning an empty dataframe&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SQLiteDB.get_database_tables"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.get_database_tables">[docs]</a>    <span class="k">def</span> <span class="nf">get_database_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method the retrieve a dataframe containing a list of all tables within</span>
<span class="sd">        a SQLite database file.  If the user does not pass a database name, the</span>
<span class="sd">        method will return the list of tables in the current database.  However,</span>
<span class="sd">        the user can also pass this method the name of another database file,</span>
<span class="sd">        and this will return a list of tables in that database file/</span>

<span class="sd">        :param database: The name of the database or database file that the tables</span>
<span class="sd">                         will be retrieved from.</span>
<span class="sd">        :return df: A dataframe containing all information relating to the tables</span>
<span class="sd">                    within the database or database file.</span>

<span class="sd">        Assuming the user has a database titled ``Inventory`` which had the</span>
<span class="sd">        tables ``Names``, ``Product``, ``Sales``.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import SQLiteDB</span>

<span class="sd">           db = SQLiteDB(&#39;test.db&#39;)</span>
<span class="sd">           dbs = db.get_database_tables(&quot;Inventory&quot;)</span>
<span class="sd">           db.close_connection()</span>
<span class="sd">           print(dbs)</span>
<span class="sd">           &gt;&gt; index  Tables</span>
<span class="sd">              0      Names</span>
<span class="sd">              1      Product</span>
<span class="sd">              2      Sales</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rename</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Tables&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve tables: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">original_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
                <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to retrieve tables: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">original_db</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">df</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SQLiteDB.get_table_columns"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.get_table_columns">[docs]</a>    <span class="k">def</span> <span class="nf">get_table_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         Retrieve the names and data types of the columns within the specified table.</span>

<span class="sd">         :param table_name: The name of the table.</span>
<span class="sd">         :param database: The database name, defaulted to currently selected database</span>
<span class="sd">                          or None</span>
<span class="sd">         :return: A pandas dataframe with headers ot Field, Type, Null, Key, Default,</span>
<span class="sd">                  and Extra</span>
<span class="sd">         :raises ValueError: If the database is not selected at the class level</span>
<span class="sd">         :raises ConnectionError: If the columns cannot be retrieved.</span>

<span class="sd">         This example shows a scenario where the database analyst has navigated</span>
<span class="sd">         into a database</span>

<span class="sd">         .. highlight:: python</span>
<span class="sd">         .. code-block:: python</span>

<span class="sd">            from cobralib.io import SQLiteDB</span>

<span class="sd">            db = SQLiteDB(&#39;test_db.db&#39;)</span>
<span class="sd">            query = &#39;&#39;&#39;CREATE TABLE IF NOT EXIST Names (</span>
<span class="sd">                name_id INTEGER AUTO_INCREMENT,</span>
<span class="sd">                FirstName VARCHAR(20) NOT NULL,</span>
<span class="sd">                MiddleName VARCHAR(20),</span>
<span class="sd">                LastName VARCHAR(20) NOT NULL,</span>
<span class="sd">                PRIMARY KEY (name_id)</span>
<span class="sd">            );</span>
<span class="sd">            &#39;&#39;&#39;</span>
<span class="sd">            db.execute_query(query)</span>
<span class="sd">            cols = db.get_table_columns(&#39;Names&#39;)</span>
<span class="sd">            db.close_conn()</span>
<span class="sd">            print(cols)</span>
<span class="sd">            &gt;&gt; index Field      Type        Null   Key     Default  Extra</span>
<span class="sd">               0     name_id    Integer     True   Primary  False   autoincrement</span>
<span class="sd">               1     FirstName  Varchar(20) False  NA       False   None</span>
<span class="sd">               2     MiddleName Varchar(20) True   NA       False   None</span>
<span class="sd">               3     LastName   Varchar(20) False  NA       False   None</span>

<span class="sd">        However, this code can also be executed when not in the database</span>

<span class="sd">         .. code-block:: python</span>

<span class="sd">            from cobralib.io import MySQLDB</span>

<span class="sd">            db = MySQLDB(&#39;username&#39;, &#39;password&#39;, port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">            cols = db.get_table_columns(&#39;Names&#39;, &#39;Address&#39;)</span>
<span class="sd">            db.close_conn()</span>
<span class="sd">            print(cols)</span>
<span class="sd">            &gt;&gt; index Field      Type        Null   Key     Default  Extra</span>
<span class="sd">               0     name_id    Integer     True   Primary  False   autoincrement</span>
<span class="sd">               1     FirstName  Varchar(20) False  NA       False   None</span>
<span class="sd">               2     MiddleName Varchar(20) True   NA       False   None</span>
<span class="sd">               3     LastName   Varchar(20) False  NA       False   None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Execute the PRAGMA command to get the table information</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PRAGMA table_info(</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

                <span class="c1"># Fetch all rows from the cursor</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The table &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

                <span class="c1"># The names of the columns in the result set</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;notnull&quot;</span><span class="p">,</span> <span class="s2">&quot;default_value&quot;</span><span class="p">,</span> <span class="s2">&quot;pk&quot;</span><span class="p">]</span>

                <span class="c1"># Convert the result set to a DataFrame</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

                <span class="c1"># Modify the DataFrame to match the output from the MySQLDB method</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Null&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;notnull&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;YES&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;NO&quot;</span><span class="p">})</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;PRI&quot;</span><span class="p">})</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;default_value&quot;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Extra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="c1"># Only include the relevant columns in the DataFrame</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Null&quot;</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="s2">&quot;Extra&quot;</span><span class="p">]]</span>

                <span class="k">return</span> <span class="n">df</span>

            <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># Handle any SQLite errors that occur</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Execute the PRAGMA command to get the table information</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PRAGMA table_info(</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

                <span class="c1"># Fetch all rows from the cursor</span>
                <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The table &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39; does not exist.&quot;</span><span class="p">)</span>

                <span class="c1"># The names of the columns in the result set</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;notnull&quot;</span><span class="p">,</span> <span class="s2">&quot;default_value&quot;</span><span class="p">,</span> <span class="s2">&quot;pk&quot;</span><span class="p">]</span>

                <span class="c1"># Convert the result set to a DataFrame</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

                <span class="c1"># Modify the DataFrame to match the output from the MySQLDB method</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Null&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;notnull&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;YES&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;NO&quot;</span><span class="p">})</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;pk&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;PRI&quot;</span><span class="p">})</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;default_value&quot;</span><span class="p">]</span>
                <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Extra&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="c1"># Only include the relevant columns in the DataFrame</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Null&quot;</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="s2">&quot;Extra&quot;</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">original_db</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">df</span>

            <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">original_db</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">()</span>
                <span class="c1"># Handle any SQLite errors that occur</span>
                <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SQLiteDB.execute_query"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.execute_query">[docs]</a>    <span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute a query with placeholders and return the result as a Pandas DataFrame.</span>
<span class="sd">        The user of this class should ensure that when applicable they parameteratize</span>
<span class="sd">        the inputs to this method to minimize the potential for an injection</span>
<span class="sd">        attack</span>

<span class="sd">        :param query: The query with placeholders.</span>
<span class="sd">        :param params: The values to be substituted into the placeholders</span>
<span class="sd">                       (default is an empty tuple).</span>
<span class="sd">        :return: A Pandas DataFrame with the query result.</span>
<span class="sd">        :raises ValueError: If the database name is not provided.</span>
<span class="sd">        :raises Error: If the query execution fails.</span>

<span class="sd">        Example usage when parameters are provided:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          from mylib.io import SQLiteDB</span>

<span class="sd">          db = SQLiteDB(&#39;example.db&#39;)</span>
<span class="sd">          query = &quot;SELECT * FROM names WHERE name_id = ?&quot;</span>
<span class="sd">          params = (2,)</span>
<span class="sd">          result = db.execute_query(query, params)</span>
<span class="sd">          print(result)</span>
<span class="sd">          &gt;&gt; index  name_id  FirstName  LastName</span>
<span class="sd">             0      2        Fred       Smith</span>

<span class="sd">        Example usage when no parameters are provided:</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">          from mylib.io import SQLiteDB</span>

<span class="sd">          db = SQLiteDB(&#39;example.db&#39;)</span>
<span class="sd">          query = &quot;SELECT * FROM names&quot;</span>
<span class="sd">          result = db.execute_query(query)</span>
<span class="sd">          print(result)</span>
<span class="sd">          &gt;&gt; index  name_id  FirstName  LastName</span>
<span class="sd">           0        1        Jon        Webb</span>
<span class="sd">           1        2        Fred       Smith</span>
<span class="sd">           2        3        Jillian    Webb</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;The number of placeholders in the query does not &quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;match the number of parameters.&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">)</span>
        <span class="n">num_placeholders</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_placeholders</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to execute query: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to execute query: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SQLiteDB.csv_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.csv_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">csv_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">csv_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">csv_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_headers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from a CSV or TXT file and insert it into the specified table.</span>

<span class="sd">        :param csv_file: The path to the CSV file or TXT file.</span>
<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param csv_headers: The names of the columns in the TXT file and datatypes</span>
<span class="sd">                            as a dictionary.</span>
<span class="sd">        :param table_headers: The names of the columns in the table (default is None,</span>
<span class="sd">                              assumes CSV column names and table column names</span>
<span class="sd">                              are the same).</span>
<span class="sd">        :param delimiter: The seperating delimeter in the text file.  Defaulted to</span>
<span class="sd">                          &#39;,&#39; for a CSV file, but can work with other delimeters</span>
<span class="sd">        :param skip: The number of rows to be skipped if metadata exists before</span>
<span class="sd">                     the header definition.  Defaulted to 0</span>
<span class="sd">        :raises ValueError: If the CSV file or table name is not provided, or if</span>
<span class="sd">                            the number of CSV columns and table columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CSV column names are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">csv_data</span> <span class="o">=</span> <span class="n">read_text_columns_by_headers</span><span class="p">(</span>
                <span class="n">csv_file</span><span class="p">,</span> <span class="n">csv_headers</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_headers</span>
            <span class="p">]</span>

            <span class="n">csv_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table_headers</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">csv_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">insert_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;?&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># Commit changes</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SQLiteDB.excel_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.excel_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">excel_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">excel_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">excel_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_headers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Sheet1&quot;</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from an Excel file and insert it into the specified table.</span>

<span class="sd">        :param excel_file: The path to the Excel file.</span>
<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param excel_headers: The names of the columns in the Excel file and their</span>
<span class="sd">                              data types as a dictionary.</span>
<span class="sd">        :param table_headers: The names of the columns in the table (default is None,</span>
<span class="sd">                              assumes Excel column names and table column names are</span>
<span class="sd">                              the same).</span>
<span class="sd">        :param sheet_name: The name of the sheet in the Excel file (default is &#39;Sheet1&#39;).</span>
<span class="sd">        :param skip: The number of rows to be skipped if metadata exists before</span>
<span class="sd">                     the header definition. Defaulted to 0.</span>
<span class="sd">        :raises ValueError: If the Excel file, table name, or sheet name is not</span>
<span class="sd">                            provided, or if the number of Excel columns and table</span>
<span class="sd">                            columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">excel_headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Excel column names are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">excel_data</span> <span class="o">=</span> <span class="n">read_excel_columns_by_headers</span><span class="p">(</span>
                <span class="n">excel_file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">excel_headers</span><span class="p">,</span> <span class="n">skip</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">excel_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_headers</span>
            <span class="p">]</span>

            <span class="n">excel_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">excel_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">excel_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table_headers</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">excel_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">insert_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;?&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SQLiteDB.pdf_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.SQLiteDB.pdf_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">pdf_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pdf_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pdf_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">page_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a table from a PDF file and insert it into the specified SQLite table.</span>

<span class="sd">        :param pdf_file: The path to the PDF file.</span>
<span class="sd">        :param table_name: The name of the SQLite table.</span>
<span class="sd">        :param pdf_headers: A dictionary of column names in the PDF and their data</span>
<span class="sd">                            types.</span>
<span class="sd">        :param table_columns: The names of the columns in the SQLite table</span>
<span class="sd">                              (default is None, assumes PDF column names and SQLite</span>
<span class="sd">                              column names are the same).</span>
<span class="sd">        :param table_idx: Index of the table in the PDF (default: 0).</span>
<span class="sd">        :param page_num: Page number from which to extract the table (default: 0).</span>
<span class="sd">        :param skip: The number of rows to skip in the PDF table.</span>
<span class="sd">        :raises ValueError: If the PDF file, table name, or sheet name is not</span>
<span class="sd">                            provided, or if the number of PDF headers and table</span>
<span class="sd">                            columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pdf_headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PDF headers are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Read the table from the PDF file</span>
            <span class="n">pdf_data</span> <span class="o">=</span> <span class="n">read_pdf_columns_by_headers</span><span class="p">(</span>
                <span class="n">pdf_file</span><span class="p">,</span> <span class="n">pdf_headers</span><span class="p">,</span> <span class="n">table_idx</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">skip</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">table_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pdf_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_columns</span>
            <span class="p">]</span>
            <span class="n">pdf_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pdf_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">pdf_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table_columns</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">pdf_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">insert_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;?&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ==========================================================================================</span>
    <span class="c1"># PRIVATE-LIKE METHODS</span>

    <span class="k">def</span> <span class="nf">_create_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a connection to the SQLite database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create a connection due to DatabaseError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_sanitize_column_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sanitize column names to include only alphanumeric characters and underscores.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\W|^(?=\d)&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>


<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>


<div class="viewcode-block" id="PostGreSQLDB"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB">[docs]</a><span class="k">class</span> <span class="nc">PostGreSQLDB</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5432</span><span class="p">,</span>
        <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the database connection to a PostgreSQL server.</span>

<span class="sd">        :param username: The PostgreSQL username.</span>
<span class="sd">        :param password: The PostgreSQL password.</span>
<span class="sd">        :param database: The name of the database to connect to.</span>
<span class="sd">        :param port: The port number for the PostgreSQL server (default is 5432).</span>
<span class="sd">        :param hostname: The server&#39;s hostname (default is &#39;localhost&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="n">hostname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_connection</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">database</span><span class="p">)</span>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.close_connection"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.close_connection">[docs]</a>    <span class="k">def</span> <span class="nf">close_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the connection to the PostgreSQL server and database.</span>

<span class="sd">        :raises ConnectionError: If there&#39;s an issue closing the connection or cursor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to close the connection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic handler for any other exceptions</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to close the connection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.change_database"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.change_database">[docs]</a>    <span class="k">def</span> <span class="nf">change_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change to a different PostgreSQL database.</span>

<span class="sd">        :param database: The name of the database to switch to.</span>
<span class="sd">        :raises ConnectionError: If there&#39;s an issue establishing a connection</span>
<span class="sd">                                 to the new database.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Close the current connection if it exists</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Establish a new connection to the desired database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
                <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                <span class="n">password</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
                <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
                <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to change to database &#39;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic handler for any other exceptions</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to change to database &#39;</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.get_databases"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.get_databases">[docs]</a>    <span class="k">def</span> <span class="nf">get_databases</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a list of databases from the PostgreSQL server.</span>

<span class="sd">        :return: A pandas DataFrame containing the list of databases with the</span>
<span class="sd">                 column header &quot;Databases&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT datname FROM pg_database;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Databases&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch databases: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.get_database_tables"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.get_database_tables">[docs]</a>    <span class="k">def</span> <span class="nf">get_database_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a list of tables from the specified or current PostgreSQL database.</span>

<span class="sd">        :param database: The name of the database to fetch tables from. If not</span>
<span class="sd">                         provided, uses the current database.</span>
<span class="sd">        :return: A pandas DataFrame containing the list of tables with the column</span>
<span class="sd">                 header &quot;Tables&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">original_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="c1"># If db_name is provided, switch to that database</span>
        <span class="k">if</span> <span class="n">database</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;SELECT tablename FROM pg_tables WHERE schemaname=&#39;public&#39;;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Tables&quot;</span><span class="p">])</span>

            <span class="c1"># If db_name was provided, switch back to the original database</span>
            <span class="k">if</span> <span class="n">database</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">change_database</span><span class="p">(</span><span class="n">original_db</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">df</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">database</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">change_database</span><span class="p">(</span><span class="n">original_db</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">):</span>
                    <span class="k">pass</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch tables: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.get_table_columns"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.get_table_columns">[docs]</a>    <span class="k">def</span> <span class="nf">get_table_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch column details for the given table in the specified or current</span>
<span class="sd">        PostgreSQL database.</span>

<span class="sd">        :param table_name: The name of the table to fetch column details for.</span>
<span class="sd">        :param database: The name of the database the table resides in. If not provided,</span>
<span class="sd">                         uses the current database.</span>
<span class="sd">        :return: A pandas DataFrame containing column details.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">original_db</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>

        <span class="c1"># If db is provided, switch to that database</span>
        <span class="k">if</span> <span class="n">database</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_database</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Fetch column details</span>
            <span class="n">column_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SELECT column_name as &quot;Field&quot;,</span>
<span class="s2">                   data_type as &quot;Type&quot;,</span>
<span class="s2">                   is_nullable = &#39;YES&#39; as &quot;Null&quot;,</span>
<span class="s2">                   column_default as &quot;Default&quot;,</span>
<span class="s2">                   &#39;&#39; as &quot;Key&quot;,</span>
<span class="s2">                   &#39;&#39; as &quot;Extra&quot;</span>
<span class="s2">            FROM information_schema.columns</span>
<span class="s2">            WHERE table_name = &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39;</span>
<span class="s2">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">column_query</span><span class="p">)</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Null&quot;</span><span class="p">,</span> <span class="s2">&quot;Default&quot;</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">,</span> <span class="s2">&quot;Extra&quot;</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Fetch primary key</span>
            <span class="n">pk_query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            SELECT a.attname as &quot;Field&quot;, &#39;Primary&#39; as &quot;Key&quot;</span>
<span class="s2">            FROM   pg_index i</span>
<span class="s2">            JOIN   pg_attribute a ON a.attrelid = i.indrelid AND a.attnum = ANY(i.indkey)</span>
<span class="s2">            WHERE  i.indrelid = &#39;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#39;::regclass AND i.indisprimary;</span>
<span class="s2">            &quot;&quot;&quot;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">pk_query</span><span class="p">)</span>
            <span class="n">pks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">pk</span> <span class="ow">in</span> <span class="n">pks</span><span class="p">:</span>
                <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Field&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">pk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Primary&quot;</span>

            <span class="c1"># - Updating Foreign Key would be a more involved process due to the</span>
            <span class="c1">#   way PostgreSQL manages it,</span>
            <span class="c1"># skipping that for the moment.</span>

            <span class="c1"># If db was provided, switch back to the original database</span>
            <span class="k">if</span> <span class="n">database</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">change_database</span><span class="p">(</span><span class="n">original_db</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">df</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># - If db was provided and there&#39;s an error, try to switch back to</span>
            <span class="c1">#   the original database</span>
            <span class="k">if</span> <span class="n">database</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">change_database</span><span class="p">(</span><span class="n">original_db</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">):</span>
                    <span class="k">pass</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch table columns: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.execute_query"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.execute_query">[docs]</a>    <span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the provided SQL query and returns the results as a pandas DataFrame.</span>

<span class="sd">        :param query: The SQL query to execute.</span>
<span class="sd">        :param params: A tuple of parameters to bind to the query.</span>
<span class="sd">        :return: A pandas DataFrame containing the query results.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">desc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">(),</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to execute query: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.csv_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.csv_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">csv_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">csv_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">csv_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_headers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from a CSV or TXT file and insert it into the specified table.</span>

<span class="sd">        :param csv_file: The path to the CSV file or TXT file.</span>
<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param csv_headers: The names of the columns in the TXT file and datatypes</span>
<span class="sd">                            as a dictionary.</span>
<span class="sd">        :param table_headers: The names of the columns in the table (default is None,</span>
<span class="sd">                              assumes CSV column names and table column names</span>
<span class="sd">                              are the same).</span>
<span class="sd">        :param delimiter: The seperating delimeter in the text file.  Defaulted to</span>
<span class="sd">                          &#39;,&#39; for a CSV file, but can work with other delimeters</span>
<span class="sd">        :param skip: The number of rows to be skipped if metadata exists before</span>
<span class="sd">                     the header definition.  Defaulted to 0</span>
<span class="sd">        :raises ValueError: If the CSV file or table name is not provided, or if</span>
<span class="sd">                            the number of CSV columns and table columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>

<span class="sd">        Assune we have a csv table with the following Columns, ``FirstName``,</span>
<span class="sd">        ``MiddleName``, ``LastName``.  Within the ``Names`` database we have</span>
<span class="sd">        a table with no entries that has columns for ``First`` and ``Last``.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import PostGreSQLDB</span>

<span class="sd">           db = PostGreSQL(&#39;username&#39;, &#39;password&#39;, &#39;Names&#39;, port=3306,</span>
<span class="sd">                           hostname=&#39;localhost&#39;)</span>
<span class="sd">           db.csv_to_table(&#39;csv_file.csv&#39;, &#39;FirstLastName&#39;,</span>
<span class="sd">                           [&#39;FirstName&#39;: str, &#39;LastName&#39;: str],</span>
<span class="sd">                           [&#39;First&#39;, &#39;Last&#39;])</span>
<span class="sd">           query = &quot;SELDCT * FROM Names;&quot;</span>
<span class="sd">           result = db.query_db(query)</span>
<span class="sd">           print(result)</span>
<span class="sd">           &gt;&gt; index  name_id First   Last</span>
<span class="sd">              0      1       Jon     Webb</span>
<span class="sd">              1      2       Fred    Smith</span>
<span class="sd">              2      3       Jillian Webb</span>

<span class="sd">        If instead of a csv file, you have a text file that uses spaces as</span>
<span class="sd">        a delimeter, and the first two rows are consumed by file metadata</span>
<span class="sd">        before reaching the header, the following code will work</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import PostGreSQLDB</span>

<span class="sd">           db = PostGreSQLDB(&#39;username&#39;, &#39;password&#39;, &#39;Names&#39;,</span>
<span class="sd">                              port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           db.csv_to_table(&#39;txt_file.txt&#39;, &#39;FirstLastName&#39;,</span>
<span class="sd">                           [&#39;FirstName&#39;: str, &#39;LastName&#39;: str],</span>
<span class="sd">                           [&#39;First&#39;, &#39;Last&#39;], delemeter=r&quot;\\s+&quot;, skip=2)</span>
<span class="sd">           query = &quot;SELDCT * FROM Names;&quot;</span>
<span class="sd">           result = db.query_db(query)</span>
<span class="sd">           print(result)</span>
<span class="sd">           &gt;&gt; index  name_id First   Last</span>
<span class="sd">              0      1       Jon     Webb</span>
<span class="sd">              1      2       Fred    Smith</span>
<span class="sd">              2      3       Jillian Webb</span>

<span class="sd">        ... [rest of the docstring remains unchanged] ...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;CSV column names are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">csv_data</span> <span class="o">=</span> <span class="n">read_text_columns_by_headers</span><span class="p">(</span>
                <span class="n">csv_file</span><span class="p">,</span> <span class="n">csv_headers</span><span class="p">,</span> <span class="n">skip</span><span class="o">=</span><span class="n">skip</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_headers</span>
            <span class="p">]</span>

            <span class="n">csv_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">csv_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">csv_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table_headers</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">csv_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">insert_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>  <span class="c1"># Commit changes</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">InterfaceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to the interface.</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Generic error handler for any other exceptions.</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.excel_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.excel_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">excel_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">excel_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">excel_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_headers</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">sheet_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Sheet1&quot;</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from an Excel file and insert it into the specified table.</span>

<span class="sd">        :param excel_file: The path to the Excel file.</span>
<span class="sd">        :param table_name: The name of the table.</span>
<span class="sd">        :param excel_headers: The names of the columns in the Excel file and their</span>
<span class="sd">                              data types as a dictionary</span>
<span class="sd">        :param table_headers: The names of the columns in the table (default is None,</span>
<span class="sd">                              assumes Excel column names and table column names are</span>
<span class="sd">                              the same).</span>
<span class="sd">        :param sheet_name: The name of the sheet in the Excel file</span>
<span class="sd">                           (default is &#39;Sheet1&#39;).</span>
<span class="sd">        :param skip: The number of rows to be skipped if metadata exists before</span>
<span class="sd">                     the header definition.  Defaulted to 0</span>
<span class="sd">        :raises ValueError: If the Excel file, table name, or sheet name is not</span>
<span class="sd">                            provided, or if the number of Excel columns and table</span>
<span class="sd">                            columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>

<span class="sd">        Assune we have an excel table with the following Columns, ``FirstName``,</span>
<span class="sd">        ``MiddleName``, ``LastName``.  Within the ``Names`` database we have</span>
<span class="sd">        a table with no entries that has columns for ``First`` and ``Last``.</span>

<span class="sd">        .. code-block:: python</span>

<span class="sd">           from cobralib.io import PostGreSQLDB</span>

<span class="sd">           db = PostGreSQL(&#39;username&#39;, &#39;password&#39;, &#39;Names&#39;,</span>
<span class="sd">                           port=3306, hostname=&#39;localhost&#39;)</span>
<span class="sd">           db.csv_to_table(&#39;excel_file.xlsx&#39;, &#39;FirstLastName&#39;,</span>
<span class="sd">                           {&#39;FirstName&#39;: str, &#39;LastName&#39;: str},</span>
<span class="sd">                           [&#39;First&#39;, &#39;Last&#39;])</span>
<span class="sd">           query = &quot;SELDCT * FROM Names;&quot;</span>
<span class="sd">           result = db.query_db(query)</span>
<span class="sd">           print(result)</span>
<span class="sd">           &gt;&gt; index  name_id First   Last</span>
<span class="sd">              0      1       Jon     Webb</span>
<span class="sd">              1      2       Fred    Smith</span>
<span class="sd">              2      3       Jillian Webb</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">excel_headers</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Excel column names are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Using pandas to read the Excel file</span>
            <span class="n">excel_data</span> <span class="o">=</span> <span class="n">read_excel_columns_by_headers</span><span class="p">(</span>
                <span class="n">excel_file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="p">,</span> <span class="n">excel_headers</span><span class="p">,</span> <span class="n">skip</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">table_headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_headers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">excel_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_headers</span>
            <span class="p">]</span>
            <span class="n">excel_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">excel_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">excel_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">table_headers</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="n">excel_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">table_headers</span><span class="p">))</span>
                <span class="p">}</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="PostGreSQLDB.pdf_to_table"><a class="viewcode-back" href="../../db.html#cobralib.db.PostGreSQLDB.pdf_to_table">[docs]</a>    <span class="k">def</span> <span class="nf">pdf_to_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">pdf_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">pdf_headers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">],</span>
        <span class="n">table_columns</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">table_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">page_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a table from a PDF file and insert it into the specified MySQL table.</span>

<span class="sd">        :param pdf_file: The path to the PDF file.</span>
<span class="sd">        :param table_name: The name of the MySQL table.</span>
<span class="sd">        :param pdf_headers: A dictionary of column names in the PDF and their data</span>
<span class="sd">                            types.</span>
<span class="sd">        :param table_columns: The names of the columns in the MySQL table</span>
<span class="sd">                              (default is None, assumes PDF column names and MySQL</span>
<span class="sd">                              column names are the same).</span>
<span class="sd">        :param table_idx: Index of the table in the PDF (default: 0).</span>
<span class="sd">        :param page_num: Page number from which to extract the table (default: 0).</span>
<span class="sd">        :param skip: The number of rows to skip in the PDF table.</span>
<span class="sd">        :raises ValueError: If the PDF file, table name, or sheet name is not</span>
<span class="sd">                            provided, or if the number of PDF headers and table</span>
<span class="sd">                            columns mismatch.</span>
<span class="sd">        :raises Error: If the data insertion fails or the data types are</span>
<span class="sd">                       incompatible.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pdf_headers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;PDF headers are required.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Read the table from the PDF file</span>
            <span class="n">pdf_data</span> <span class="o">=</span> <span class="n">read_pdf_columns_by_headers</span><span class="p">(</span>
                <span class="n">pdf_file</span><span class="p">,</span> <span class="n">pdf_headers</span><span class="p">,</span> <span class="n">table_idx</span><span class="p">,</span> <span class="n">page_num</span><span class="p">,</span> <span class="n">skip</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">table_columns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">table_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pdf_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">sanitized_columns</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_column_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">table_columns</span>
            <span class="p">]</span>
            <span class="n">pdf_header_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pdf_headers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">pdf_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">insert_data</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table_columns</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">pdf_header_keys</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="n">insert_data</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="n">placeholders</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">insert_data</span><span class="p">))</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sanitized_columns</span><span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">insert_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;INSERT INTO </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES (</span><span class="si">{</span><span class="n">placeholders</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">pgdb</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Handle errors related to</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to insert data into the table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># ==========================================================================================</span>
    <span class="c1"># PRIVATE-LIKE METHODS</span>

    <span class="k">def</span> <span class="nf">_create_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a connection to the PostgreSQL database.</span>

<span class="sd">        :param password: The PostgreSQL password.</span>
<span class="sd">        :param database: The name of the database to connect to.</span>
<span class="sd">        :return: The PostgreSQL connection object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
                <span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hostname</span><span class="p">,</span>
                <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
                <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
                <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">OperationalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create a connection due to OperationalError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">ProgrammingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create a connection due to ProgrammingError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">pgdb</span><span class="o">.</span><span class="n">InternalError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create a connection due to InternalError: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ConnectionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create a connection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># ------------------------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_sanitize_column_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sanitize column names to include only alphanumeric characters and underscores.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\W|^(?=\d)&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></div>


<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>
<span class="c1"># Factory pattern for Relational Database Management Systems</span>


<div class="viewcode-block" id="relational_database"><a class="viewcode-back" href="../../db.html#cobralib.db.relational_database">[docs]</a><span class="k">def</span> <span class="nf">relational_database</span><span class="p">(</span>
    <span class="n">db_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">hostname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RelationalDB</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method will return a relational database object of type RelationalDB</span>

<span class="sd">    :param db_type: A string representing the database management system, can be</span>
<span class="sd">                    MySQL, PostGres or SQLite. This parameter is case insensitive.</span>
<span class="sd">                    Case Insensitive</span>
<span class="sd">    :param database: The database you wish to connect to, defaulted to appropriate</span>
<span class="sd">                     port number for each database manager</span>
<span class="sd">    :param username: The username for the database connection.</span>
<span class="sd">    :param password: The password for the database connection.</span>
<span class="sd">    :param port: The port number for the database connection. Defaulted to 3306</span>
<span class="sd">    :param hostname: The hostname for the database connection</span>
<span class="sd">                     (default is &#39;localhost&#39;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MYSQL&quot;</span><span class="p">,</span> <span class="s2">&quot;SQLITE&quot;</span><span class="p">,</span> <span class="s2">&quot;POSTGRES&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">db_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">db_types</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;db_type must be one of </span><span class="si">{</span><span class="n">db_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">db_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;MYSQL&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">port</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="mi">3306</span>
        <span class="k">return</span> <span class="n">MySQLDB</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">db_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;POSTGRES&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">port</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">port</span> <span class="o">=</span> <span class="mi">5432</span>
        <span class="k">return</span> <span class="n">PostGreSQLDB</span><span class="p">(</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
            <span class="n">hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SQLiteDB</span><span class="p">(</span><span class="n">database</span><span class="p">)</span></div>


<span class="c1"># ==========================================================================================</span>
<span class="c1"># ==========================================================================================</span>
<span class="c1"># eof</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Jonathan A. Webb.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

</body>
</html>
